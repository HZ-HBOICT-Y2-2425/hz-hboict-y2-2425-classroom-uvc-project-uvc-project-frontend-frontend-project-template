name: GitHub Actions Pipeline
run-name: ${{ github.actor }} is testing GitHub Actions ðŸš€

on:
  push:
    branches:
      - main
      - pipeline
  pull_request:
    branches:
      - main

permissions:
  contents: read
  packages: read
  statuses: write

jobs:
  Build-and-Test:
    runs-on: ubuntu-latest
    name: Build and Test Job
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      - name: Install dependencies
        run: npm install

      - name: Build the software
        run: npm run build

      - name: Log success message
        if: success()
        run: echo "âœ… Build and tests completed successfully!"

  Lint:
    runs-on: ubuntu-latest
    name: Lint Code Base
    permissions:
      contents: read
      packages: read
      statuses: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Super-Linter
        uses: super-linter/super-linter@v7.2.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VALIDATE_ALL_CODEBASE: false
          FILTER_REGEX_INCLUDE: "^src/.*$"
          DEFAULT_BRANCH: main

      # Notify Slack on Success or Failure
      - name: Notify Slack on Success or Failure
        if: always()  # Always run this step
        uses: rtCamp/action-slack-notify@v2
        with:
          webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}
          message: |
            GitHub Actions job results for ${{ github.repository }}:
            - **Job**: Linter
            - **Status**: ${{ job.status }}
            - **Link to workflow**: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
